<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Axel-One: Web Edition</title>
  <style>
    body {
      font-family: monospace;
      background: #1a1a1a;
      color: white;
      text-align: center;
      padding: 20px;
    }
    .card {
      display: inline-block;
      background: #333;
      color: #fff;
      padding: 10px 20px;
      margin: 10px;
      border: 2px solid #555;
      border-radius: 10px;
      cursor: pointer;
      transition: transform 0.2s;
    }
    .card:hover {
      transform: scale(1.1);
    }
    .hidden {
      visibility: hidden;
    }
    #slapButton {
      padding: 10px 20px;
      font-size: 16px;
      margin-top: 20px;
      background-color: red;
      border: none;
      color: white;
      cursor: pointer;
    }
    #timer {
      font-size: 20px;
      margin-top: 10px;
    }
    .flash {
      color: red;
      animation: flash 0.5s infinite alternate;
    }
    @keyframes flash {
      from { color: white; }
      to { color: red; }
    }
  </style>
</head>
<body>
  <h1>Axel-One: Web Edition</h1>
  <div id="game"></div>
  <button id="slapButton" style="display:none">SLAP!</button>
  <div id="timer"></div>

  <script>
    const gameDiv = document.getElementById("game");
    const slapButton = document.getElementById("slapButton");
    const timerDisplay = document.getElementById("timer");

    let userHand = [];
    let axilianHand = [];
    let currentCard = null;
    let isUserTurn = true;
    let slapTimeout = null;
    let slapStart = 0;
    let timerInterval;

    const cardTypes = ["1", "2", "3", "Swap", "Slap", "Blank"];

    function drawCard() {
      return cardTypes[Math.floor(Math.random() * cardTypes.length)];
    }

    function dealCards() {
      for (let i = 0; i < 5; i++) {
        userHand.push(drawCard());
        axilianHand.push(drawCard());
      }
    }

    function render() {
      gameDiv.innerHTML = "";
      gameDiv.innerHTML += `<h2>Top Card: ${currentCard ?? "None"}</h2>`;
      gameDiv.innerHTML += `<h3>Axilian has ${axilianHand.length} cards</h3>`;
      if (isUserTurn) {
        gameDiv.innerHTML += `<h3>Your Hand:</h3>`;
        userHand.forEach((card, index) => {
          const cardDiv = document.createElement("div");
          cardDiv.className = "card";
          cardDiv.innerText = card;
          cardDiv.onclick = () => playCard(index, true);
          gameDiv.appendChild(cardDiv);
        });
      } else {
        gameDiv.innerHTML += `<h3>Your Hand: [Hidden]</h3>`;
      }
    }

    function isValidMove(card, top) {
      if (card === "Blank") return true;
      if (card === "Swap" || card === "Slap") return true;
      if (!top) return true;
      if (top === "1") return ["1", "2", "Swap", "Slap"].includes(card);
      if (top === "2") return ["1", "2", "3", "Swap", "Slap"].includes(card);
      if (top === "3") return ["2", "3", "Swap", "Slap"].includes(card);
      if (top === "Swap" || top === "Blank") return true;
      if (top === "Slap") return false;
      return false;
    }

    function playCard(index, isUser) {
      let hand = isUser ? userHand : axilianHand;
      const card = hand[index];
      if (!isValidMove(card, currentCard)) return;

      hand.splice(index, 1);
      currentCard = card;
      render();

      if (card === "Swap") {
        [userHand, axilianHand] = [axilianHand, userHand];
        alert("Cards swapped!");
      } else if (card === "Slap") {
        startSlap();
        return;
      } else if (card === "Blank") {
        hand.push(drawCard());
        hand.sort(() => Math.random() - 0.5); // Shuffle hand
      }

      checkBurn(hand);
      switchTurn();
    }

    function checkBurn(hand) {
      if (!hand.some(c => isValidMove(c, currentCard))) {
        alert("No playable cards! Burning 2 random cards...");
        for (let i = 0; i < 2 && hand.length > 0; i++) {
          hand.splice(Math.floor(Math.random() * hand.length), 1);
        }
      }
    }

    function startSlap() {
      slapButton.style.display = "block";
      slapStart = Date.now();
      slapButton.onclick = () => endSlap(true);
      slapTimeout = setTimeout(() => endSlap(false), 800);
    }

    function endSlap(userWon) {
      slapButton.style.display = "none";
      clearTimeout(slapTimeout);
      if (userWon) {
        alert("You slapped first! Axilian takes 2 cards.");
        axilianHand.push(drawCard(), drawCard());
      } else {
        alert("Axilian slapped first! You take 2 cards.");
        userHand.push(drawCard(), drawCard());
      }
      render();
      switchTurn();
    }

    function switchTurn() {
      isUserTurn = !isUserTurn;
      render();
      resetTimer();
      if (!isUserTurn) setTimeout(axilianMove, 500);
    }

    function axilianMove() {
      let moveIndex = -1;
      const priorities = ["Slap", "Swap", "1", "2", "3", "Blank"];
      for (let type of priorities) {
        moveIndex = axilianHand.findIndex(c => c === type && isValidMove(c, currentCard));
        if (moveIndex !== -1) break;
      }
      if (moveIndex !== -1) playCard(moveIndex, false);
      else {
        alert("Axilian burns 2 cards!");
        checkBurn(axilianHand);
        switchTurn();
      }
    }

    function resetTimer() {
      clearInterval(timerInterval);
      let time = 6;
      timerDisplay.textContent = `Time left: ${time}`;
      timerDisplay.classList.remove("flash");
      timerInterval = setInterval(() => {
        time--;
        timerDisplay.textContent = `Time left: ${time}`;
        if (time <= 3) timerDisplay.classList.add("flash");
        if (time === 0) {
          clearInterval(timerInterval);
          if (isUserTurn) {
            alert("Time's up! You lose 2 cards.");
            checkBurn(userHand);
            switchTurn();
          }
        }
      }, 1000);
    }

    dealCards();
    render();
    resetTimer();
  </script>
</body>
</html>
